<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2x2 Block Traversal Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .grid-container {
            display: inline-block;
            margin: 20px;
            vertical-align: top;
        }
        .grid {
            display: grid;
            gap: 2px;
            background: #333;
            padding: 10px;
            border-radius: 8px;
        }
        .cell {
            width: 40px;
            height: 40px;
            background: #555;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        .cell.active {
            background: #4CAF50;
            transform: scale(1.1);
        }
        .cell.block-highlight {
            border-color: #FFD700;
            background: #666;
        }
        .controls {
            margin: 20px 0;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background: #1976D2;
        }
        .info {
            margin: 20px 0;
            padding: 15px;
            background: #333;
            border-radius: 8px;
        }
        .sequence-display {
            font-family: monospace;
            background: #222;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        h2 {
            color: #4CAF50;
        }
        .block-color-0 { background: #8B4513 !important; }
        .block-color-1 { background: #2E7D32 !important; }
        .block-color-2 { background: #1565C0 !important; }
        .block-color-3 { background: #6A1B9A !important; }
        .block-color-4 { background: #D84315 !important; }
        .block-color-5 { background: #F57C00 !important; }
    </style>
</head>
<body>
    <div class="container">
        <h1>2x2 Block Traversal Pattern Test</h1>
        
        <div class="controls">
            <button onclick="testTraversal('row-major')">Row-Major (Standard)</button>
            <button onclick="testTraversal('block-2x2')">Block 2x2</button>
            <button onclick="testTraversal('column-major')">Column-Major</button>
            <button onclick="testTraversal('spiral-clockwise')">Spiral Clockwise</button>
            <button onclick="testTraversal('checkerboard')">Checkerboard</button>
            <button onclick="reset()">Reset</button>
            <button onclick="toggleSpeed()">Speed: <span id="speed">Normal</span></button>
        </div>

        <div class="info">
            <h3>Current Pattern: <span id="pattern-name">None</span></h3>
            <div class="sequence-display" id="sequence">Click a pattern to see traversal order</div>
        </div>

        <div style="display: flex; flex-wrap: wrap;">
            <div class="grid-container">
                <h2>6x4 Grid</h2>
                <div id="grid-6x4" class="grid" style="grid-template-columns: repeat(6, 1fr);"></div>
            </div>
            
            <div class="grid-container">
                <h2>8x8 Grid</h2>
                <div id="grid-8x8" class="grid" style="grid-template-columns: repeat(8, 1fr);"></div>
            </div>

            <div class="grid-container">
                <h2>12x8 Grid (Actual App Size)</h2>
                <div id="grid-12x8" class="grid" style="grid-template-columns: repeat(12, 1fr);"></div>
            </div>
        </div>

    </div>

    <script>
        let animationSpeed = 100;
        let currentAnimation = null;

        // Initialize grids
        function initGrids() {
            createGrid('grid-6x4', 6, 4);
            createGrid('grid-8x8', 8, 8);
            createGrid('grid-12x8', 12, 8);
        }

        function createGrid(id, cols, rows) {
            const grid = document.getElementById(id);
            grid.innerHTML = '';
            for (let i = 0; i < rows * cols; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.textContent = i;
                cell.id = `${id}-cell-${i}`;
                grid.appendChild(cell);
            }
        }

        // Traversal pattern generators
        function* generateTraversal(pattern, columns, rows) {
            switch (pattern) {
                case 'row-major':
                    for (let row = 0; row < rows; row++) {
                        for (let col = 0; col < columns; col++) {
                            yield row * columns + col;
                        }
                    }
                    break;
                    
                case 'column-major':
                    for (let col = 0; col < columns; col++) {
                        for (let row = 0; row < rows; row++) {
                            yield row * columns + col;
                        }
                    }
                    break;
                    
                case 'block-2x2':
                    // This is the key pattern we're testing!
                    for (let blockRow = 0; blockRow < rows; blockRow += 2) {
                        for (let blockCol = 0; blockCol < columns; blockCol += 2) {
                            // Process each 2x2 block
                            for (let r = blockRow; r < Math.min(blockRow + 2, rows); r++) {
                                for (let c = blockCol; c < Math.min(blockCol + 2, columns); c++) {
                                    yield { 
                                        index: r * columns + c,
                                        blockId: Math.floor(blockRow/2) * Math.ceil(columns/2) + Math.floor(blockCol/2)
                                    };
                                }
                            }
                        }
                    }
                    break;
                    
                case 'spiral-clockwise':
                    let top = 0, bottom = rows - 1, left = 0, right = columns - 1;
                    while (top <= bottom && left <= right) {
                        for (let col = left; col <= right; col++) {
                            yield top * columns + col;
                        }
                        top++;
                        for (let row = top; row <= bottom; row++) {
                            yield row * columns + right;
                        }
                        right--;
                        if (top <= bottom) {
                            for (let col = right; col >= left; col--) {
                                yield bottom * columns + col;
                            }
                            bottom--;
                        }
                        if (left <= right) {
                            for (let row = bottom; row >= top; row--) {
                                yield row * columns + left;
                            }
                            left++;
                        }
                    }
                    break;
                    
                case 'checkerboard':
                    for (let pass = 0; pass < 2; pass++) {
                        for (let row = 0; row < rows; row++) {
                            for (let col = 0; col < columns; col++) {
                                if ((row + col) % 2 === pass) {
                                    yield row * columns + col;
                                }
                            }
                        }
                    }
                    break;
                    
                default:
                    for (let i = 0; i < rows * columns; i++) {
                        yield i;
                    }
            }
        }

        async function testTraversal(pattern) {
            // Clear any existing animation
            if (currentAnimation) {
                clearTimeout(currentAnimation);
                currentAnimation = null;
            }
            
            reset();
            
            document.getElementById('pattern-name').textContent = pattern;
            
            const grids = [
                { id: 'grid-6x4', cols: 6, rows: 4 },
                { id: 'grid-8x8', cols: 8, rows: 8 },
                { id: 'grid-12x8', cols: 12, rows: 8 }
            ];
            
            for (const gridInfo of grids) {
                const sequence = [];
                const blockMap = new Map();
                
                for (const item of generateTraversal(pattern, gridInfo.cols, gridInfo.rows)) {
                    if (pattern === 'block-2x2') {
                        sequence.push(item.index);
                        if (!blockMap.has(item.blockId)) {
                            blockMap.set(item.blockId, []);
                        }
                        blockMap.get(item.blockId).push(item.index);
                    } else {
                        sequence.push(item);
                    }
                }
                
                // Animate the traversal
                animateSequence(gridInfo.id, sequence, blockMap, pattern);
            }
            
            // Show sequence for the first grid
            const seq = [];
            for (const item of generateTraversal(pattern, 6, 4)) {
                if (pattern === 'block-2x2') {
                    seq.push(item.index);
                } else {
                    seq.push(item);
                }
            }
            document.getElementById('sequence').textContent = `Order: [${seq.join(', ')}]`;
        }

        async function animateSequence(gridId, sequence, blockMap, pattern) {
            let delay = 0;
            
            if (pattern === 'block-2x2') {
                // First, highlight blocks with different colors
                let blockId = 0;
                for (const [bid, cells] of blockMap) {
                    cells.forEach(cellIndex => {
                        const cell = document.getElementById(`${gridId}-cell-${cellIndex}`);
                        if (cell) {
                            cell.classList.add(`block-color-${blockId % 6}`);
                        }
                    });
                    blockId++;
                }
            }
            
            // Then animate the traversal
            sequence.forEach((index, step) => {
                currentAnimation = setTimeout(() => {
                    const cell = document.getElementById(`${gridId}-cell-${index}`);
                    if (cell) {
                        cell.classList.add('active');
                        cell.textContent = step;
                    }
                }, delay);
                delay += animationSpeed;
            });
        }

        function reset() {
            document.querySelectorAll('.cell').forEach(cell => {
                cell.classList.remove('active');
                cell.className = 'cell';
                const index = cell.id.split('-').pop();
                cell.textContent = index;
            });
            document.getElementById('pattern-name').textContent = 'None';
            document.getElementById('sequence').textContent = 'Click a pattern to see traversal order';
        }

        function toggleSpeed() {
            const speeds = { 50: 'Fast', 100: 'Normal', 200: 'Slow', 500: 'Very Slow' };
            const speedKeys = Object.keys(speeds).map(Number);
            const currentIndex = speedKeys.indexOf(animationSpeed);
            const nextIndex = (currentIndex + 1) % speedKeys.length;
            animationSpeed = speedKeys[nextIndex];
            document.getElementById('speed').textContent = speeds[animationSpeed];
        }

        // Initialize on load
        initGrids();
    </script>
</body>
</html>